<ng-template #customLoadingTemplate>

</ng-template>

<ngx-loading [show]="loading" [config]="{
    'primaryColour': '#4c4f52',
    'secondaryColour': '#4c4f52',
    'tertiaryColour': '#4c4f52'
  }" [template]="customLoadingTemplate"></ngx-loading>
<!-- row -->
<div class="row">
  <div class="col-12">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <h4 class="card-title">{{ titulo }}</h4>
          <hr class="m-t-0 m-b-15">

          <form class="m-t-0" #proyectoForm="ngForm">

            <div class="row pt-3">
              <div class="col-md-6">
                <div class="form-group has-danger" [class]="validarError('nombre',1)">
                  <label class="control-label">Nombre * <small>{{validarError('nombre',2)}}</small></label>
                  <input type="text" (keyup)="keyup($event.target )" class="form-control" [(ngModel)]="formacion.nombre"
                    name="nombre" placeholder="">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group has-danger" [class]="validarError('urlAmigable',1)">
                  <label class="control-label">Url amigable *
                    <small>{{validarError('urlAmigable',2)}}</small></label>
                  <input type="text" class="form-control" [(ngModel)]="formacion.urlAmigable" name="urlAmigable"
                    disabled>
                </div>
              </div>
            </div>

            <div class="row pt-3">
              <div class="col-md-6">
                <div class="form-group" [class]="validarError('idpDestacado',1)">
                  <label class="control-label">Destacado* <small>{{validarError('idpDestacado',2)}}</small></label>
                  <select class="form-select mr-sm-2" [(ngModel)]="formacion.idpDestacado" name="idpDestacado"
                    id="idpDestacado" tabindex="1" [compareWith]="compararParametro">
                    @for (idpDestacado of idpDestacados; track $index) {
                    <option [ngValue]="idpDestacado">
                      {{ idpDestacado.nombre }}
                    </option>
                    }
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group" [class]="validarError('idpTipo',1)">
                  <label class="control-label">Tipo * <small>{{validarError('idpTipo',2)}}</small></label>
                  <select class="form-select mr-sm-2" [(ngModel)]="formacion.idpTipo" [compareWith]="compararParametro"
                    name="idpTipo" id="idpTipo" tabindex="1">
                    @for (idpTipo of idpTipos; track $index) {
                    <option [ngValue]="idpTipo">
                      {{ idpTipo.nombre }}
                    </option>
                    }
                  </select>
                </div>
              </div>
            </div>
            <div class="row pt-3">

              <div class="col-md-12">
                <div class="form-group has-danger" [class]="validarError('descripcion',1)">
                  <label class="control-label">Descripción
                    <small>{{validarError('descripcion',2)}}</small></label>
                  <angular-editor placeholder="" [(ngModel)]="formacion.descripcion" name="descripcion"
                    [config]="editorConfig">
                    <ng-template #customButtons let-executeCommandFn="executeCommandFn">

                    </ng-template>
                  </angular-editor>
                </div>
              </div>
            </div>

            <div class="row pt-3">
              <div class="col-md-12">
                <label class="control-label">Contenido <small>{{validarError('contenido',2)}}</small></label>

                <angular-editor placeholder="" [(ngModel)]="formacion.contenido" name="contenido"
                  [config]="editorConfig">
                  <ng-template #customButtons let-executeCommandFn="executeCommandFn">
                    <ae-toolbar-set>
                      <ae-button #botonFileManager iconClass="fa fa-folder" title="Administrador de archivos"
                        (buttonClick)="fileManager(content,'contenido')"></ae-button>
                      <ae-button *ngIf="imgSelected!=''" #botonAgregar iconClass="fa fa-image" title="Agregar imagen"
                        (buttonClick)="executeCommandFn('insertHtml', imgSelected)"></ae-button>

                    </ae-toolbar-set>
                  </ng-template>
                </angular-editor>
              </div>
            </div>

            <!-- <div class="row pt-3">
              <div class="col-md-6">
                <div class="form-group">
                  <label class="control-label">Imagen</label>
                  <div>
                    <input type="text" class="form-control" [(ngModel)]="formacion.urlImagen" name="urlImagen"
                      style="display:inline;max-width: 75%; margin-right: 5px;" readonly>
                    <button (click)="abrirModalSubirImg(modalSubirImagen)" class="btn btn-secondary"
                      style="display:inline;margin-right: 5px;">
                      Adjuntar</button>
                    <br>
                    <small class="text-muted">Imagen en formato: JPG, resolución: 72 ppi,
                      ancho: 800 px
                      y alto: 600 px.</small>
                  </div>
                  <div class="form-group">
                    <label class="control-label">Visualización de imagen</label>
                    <div class="box-img">
                      <img
                        [src]="((imageSrc!=null)?imageSrc:((urlImagen1 != null)? urlImagen1 : urlImage+'/archivos/proyecto/imagen.png'))"
                        class="col-md-5">
                    </div>
                    <div class="form-group" *ngIf="formacion.urlImagen!=null && formacion.idFormacion>0">

                      <div>
                        <a href="javascript:void(0);" (click)="eliminarImagen(formacion)">Eliminar imagen</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div> -->
            <!--  -->

            <div class="row pt-3">
              <div class="col-md-6">
                <div class="form-group">
                  <label class="control-label">Imagen </label>
                  <div>
                    <input type="text" class="form-control" [(ngModel)]="formacion.urlImagen" name="urlImagen"
                      style="display:inline;max-width: 75%; margin-right: 5px;" readonly>
                    <button (click)="abrirModalSubirImg(modalSubirImagen)" class="btn btn-secondary"
                      style="display:inline;margin-right: 5px;">
                      Adjuntar</button>
                    <br>
                    <small class="text-muted">Imagen en formato: JPG, resolución: 72 ppi, ancho: 800 px
                      y alto: 600 px.</small>
                  </div>

                  @if (formacion.urlImagen && formacion.idFormacion>0) {

                  <div class="form-group">
                    <div>
                      <a class="btn-eliminar" href="javascript:void(0);" (click)="eliminarImagen(formacion)">Eliminar
                        imagen
                      </a>
                    </div>
                  </div>
                  }
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label class="control-label">Visualización de imagen</label>
                  <div class="box-img">
                    <img
                      [src]="((imageSrc!=null)?imageSrc:((urlImagen1 != null)? urlImagen1 : urlImage+'/archivos/formacion/imagen.png'))"
                      class="col-md-5">
                  </div>
                </div>
              </div>

            </div>

            <div class="row pt-3">
              <div class="col-md-12">
                <label class="control-label d-block">Palabras clave SEO</label>
                <textarea class="form-control w-100" [(ngModel)]="formacion.palabrasClaveSeo"
                  name="palabrasClaveSeo"></textarea>
              </div>
            </div>

            <div class="row pt-3">
              <div class="col-md-12">
                <label class="control-label d-block">Título SEO</label>
                <textarea class="form-control w-100" [(ngModel)]="formacion.tituloSeo" name="tituloSeo"></textarea>
              </div>
            </div>

            <div class="row pt-3">
              <div class="col-md-12">
                <label class="control-label d-block">Descripción SEO</label>
                <textarea class="form-control w-100" [(ngModel)]="formacion.descripcionSeo"
                  name="descripcionSeo"></textarea>
              </div>
            </div>


            <div class="row pt-3">
              <div class="col-md-6">
                <div class="form-group" [class]="validarError('estado',1)">
                  <label class="control-label">Estado <small>{{validarError('estado',2)}}</small></label>
                  <select class="form-select mr-sm-2" [(ngModel)]="formacion.estado" [compareWith]="compararEstado"
                    name="estado" id="estado" tabindex="1">
                    @for (estado of estados; track $index) {
                    <option [ngValue]="estado">
                      {{ estado.nombre }}
                    </option>
                    }
                  </select>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-group has-danger" [class]="validarError('orden',1)">
                  <label class="control-label">Orden * <small>{{validarError('orden',2)}}</small></label>
                  <input type="text" class="form-control" [(ngModel)]="formacion.orden" name="orden">
                </div>
              </div>

              <div class="row pt-3">
                <div class="col-md-6">
                  <div class="form-group" [class]="validarError('fechaProyecto',1)">
                    <label class="control-label">Fecha de proyecto *
                      <small>{{validarError('fechaProyecto',2)}}</small> </label>
                    <input type="date" class="form-control" [(ngModel)]="formacion.fechaFormacion" name="fechaProyecto">
                  </div>
                </div>
                @if (formacion.idFormacion>0) {
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="control-label">Fecha registro</label>
                    <input type="text" class="form-control" name="fecha"
                      value="{{formacion.fecha | date: 'dd/MM/yyyy'}}" disabled>
                  </div>
                </div>
                }
              </div>
            </div>
            <!--/row-->


            <div class="form-actions py-3 d-flex gap-3">
              <button type="submit" class="btn btn-primary" role="button" (click)='guardar()'>
                <fa-icon [icon]="faCheck"></fa-icon>
                Guardar</button>

              <a [routerLink]="['/formacion/lista']" class="btn btn-secondary">
                <fa-icon [icon]="faArrowLeft"></fa-icon>
                Regresar</a>
            </div>
          </form>

        </div>
      </div>
    </div>
  </div>
</div>
<!-- row -->

<!--- ------------------
Modal subir Imagen
---------------------->
<ng-template #modalSubirImagen let-modal>
  <div class="modal-header">
    <h4 class="modal-title">Adjuntar imagen de proyecto</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <upload-formacion [formacion]="formacion"></upload-formacion>
  </div>
  <div class="modal-footer"><button type="button" class="btn btn-inverse"
      (click)="modal.dismiss('Cross click')">Cerrar</button></div>
</ng-template>

<!--- ------------------
Modal subir Imagenes adicionales
---------------------->
<!-- <ng-template #modalSubirImagenes let-modal>
  <div class="modal-header">
    <h4 class="modal-title">Subir imágenes adicionales</h4>

    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>

  </div>
  <div class="modal-body">
    <upload-formacionImagen [proyectoImagen]="proyectoImagen"
      [erroresProyectoImagen]="erroresProyectoImagen"></upload-formacionImagen>
  </div>
</ng-template> -->

<!--FileManager Modal-->
<ng-template #content let-modal>
  <div class="modal-header">
    <h3 class="modal-title" id="modal-basic-title">Administrador de archivos</h3>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <file-manager></file-manager>
  </div>
</ng-template>
