<ng-template #customLoadingTemplate></ng-template>

<ngx-loading [show]="loading"
  [config]="{'fullScreenBackdrop':true, 'primaryColour': '#cd2a1f ', 'secondaryColour': '#cd2a1f ','tertiaryColour': '#cd2a1f '}"
  [template]="customLoadingTemplate"></ngx-loading>

<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <h4 class="page-title">Gestión de contenidos web</h4>
        <hr class="m-t-0 m-b-15">
        <form #filtroForm="ngForm">
          <div class="d-flex justify-content-start bg-light mb-3 gap-3 p-2 border sli">
            <div class="form-group">
              <small id="name" class="form-text">Ordenar por</small>
              <select class="form-control form-select custom-select mr-sm-2"
                [(ngModel)]="contenidoWebFiltro.ordenCriterio" name="ordenCriterio">
                <option value="fecha">Fecha de registro</option>
                <option value="nombre">Nombre</option>
                <option value="orden">Orden</option>
              </select>
            </div>

            <div class="form-group m-r-5">
              <small id="name" class="form-text">&nbsp;</small>
              <select class="form-control form-select custom-select mr-sm-2" [(ngModel)]="contenidoWebFiltro.ordenTipo"
                name="ordenContenidoWeb">
                <option value="asc">Asc</option>
                <option selected value="desc">Desc</option>
              </select>
            </div>

            <div class="form-group">
              <small id="name" class="form-text">Buscar por</small>
              <select class="form-control form-select custom-select mr-sm-2" [(ngModel)]="contenidoWebFiltro.parametro"
                name="parametro">
                <option selected value="nombre">Nombre</option>
              </select>
            </div>

            <div class="form-group m-r-5">
              <small id="name" class="form-text">&nbsp;</small>
              <input type="text" class="form-control" [(ngModel)]="contenidoWebFiltro.valor" name="valor"
                placeholder="">
            </div>

            <div class="form-group m-r-5">
              <small id="name" class="form-text">Estado</small>
              <select class="form-control form-select custom-select mr-sm-2" [(ngModel)]="contenidoWebFiltro.idEstado"
                name="idEstado">
                <option [ngValue]="0">Todos</option>
                @for (estado of estados; track $index) {
                <option [ngValue]="estado.idEstado">{{ estado.nombre }}
                </option>
                }
              </select>
            </div>
            <div class="form-group m-r-5">
              <small id="name" class="form-text">Tipo</small>
              <select class="form-control form-select custom-select mr-sm-2" [(ngModel)]="contenidoWebFiltro.idPtipo"
                name="idPtipo">
                <option [ngValue]="0">Todos</option>
                @for (ptipo of ptipos; track $index) {
                <option [ngValue]="ptipo.idParametro">{{ ptipo.nombre }}</option>
                }

              </select>
            </div>

            <div class="form-group m-r-5">
              <small id="name" class="form-text">Categoría</small>
              <select class="form-control form-select custom-select mr-sm-2"
                [(ngModel)]="contenidoWebFiltro.idContenidoWebCategoria" name="idContenidoWebCategoria">
                <option [ngValue]="0">Todos</option>
                @for (categoria of categorias; track $index) {
                <option [ngValue]="categoria.idContenidoWebCategoria">
                  {{categoria.nombre}}
                </option>
                }
              </select>
            </div>
            <div class="form-group">
              <small id="name" class="form-text">&nbsp;</small>
              <button type="button" class="form-control btn btn-primary" (click)="actualizar()">
                <fa-icon [icon]="faSearch"></fa-icon>Buscar</button>
            </div>
            <div class="form-group">
              <small id="name" class="form-text">&nbsp;</small>
              <button type="button" class="form-control btn btn-secondary" (click)="restablecer()">
                <fa-icon [icon]="faRefresh"></fa-icon>
              </button>
            </div>

          </div>
        </form>

        <div class="d-flex justify-content-start gap-3">
          <button type="button" class="btn btn-primary" [routerLink]="['/contenido-web/editar']">
            <fa-icon [icon]="faList"></fa-icon>
            Nuevo contenido web</button>
          <a [routerLink]="['/dashboard/inicio']" class="btn btn-secondary">
            <fa-icon [icon]="faArrowLeft"></fa-icon>

            Regresar</a>
          <div class="form-group">
            <select class="form-control form-select custom-select float-right"
              [(ngModel)]="contenidoWebFiltro.registros" name="registros" (ngModelChange)="actualizarPaginacion()">
              <option [ngValue]="10">10</option>
              <option [ngValue]="20">20</option>
              <option [ngValue]="50">50</option>
            </select>
          </div>
        </div>

        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr class="thead-light">
                <th scope="col"><a style="cursor:pointer" class="ng2-smart-sort-link sort">Nombre</a></th>

                <th style="width: 100px;" scope="col" class="text-center"><a style="cursor:pointer"
                    class="ng2-smart-sort-link sort">Orden</a></th>
                <th style="width: 130px;" scope="col" class="text-center"><a style="cursor:pointer"
                    class="ng2-smart-sort-link sort">Categoria</a></th>
                <th style="width: 120px;" scope="col" class="text-center"><a style="cursor:pointer"
                    class="ng2-smart-sort-link sort">Tipo</a></th>
                <th style="width: 120px;" scope="col" class="text-center"><a style="cursor:pointer"
                    class="ng2-smart-sort-link sort">Estado</a></th>
                <th style="width: 120px;" scope="col" class="text-center"><a style="cursor:pointer"
                    class="ng2-smart-sort-link sort">Fecha</a></th>
                <th style="width: 120px;" scope="col" class="text-right"><a style="cursor:pointer"
                    class="ng2-smart-sort-link sort"></a></th>
              </tr>
            </thead>
            <tbody>
              @for (contenidoWeb of contenidosWeb; track $index) {
              <tr>
                <td class="text-left">{{ contenidoWeb.nombre }} <br> [{{ contenidoWeb.urlAmigable }}] </td>
                <td class="text-center">{{ contenidoWeb.orden }} </td>
                <td class="text-center">{{
                  contenidoWeb.contenidoWebCategoria?contenidoWeb.contenidoWebCategoria.nombre:"-" }} </td>
                <td class="text-center">{{ contenidoWeb.ptipo?.nombre }} </td>
                <td class="text-center">{{ contenidoWeb.estado.nombre }} </td>
                <td class="text-center">{{ contenidoWeb.fecha | date:"dd/MM/yyyy" }}</td>
                <td class="text-end">
                  <a [routerLink]="['/contenido-web/editar/', contenidoWeb.idContenidoWeb]" class="mx-2" placement="top"
                    ngbTooltip="Editar contenidoWeb">
                    <fa-icon [icon]="faPencil"></fa-icon>
                  </a>

                  <a href="javascript:void(0);" (click)="eliminar(contenidoWeb)" placement="top"
                    ngbTooltip="Eliminar contenidoWeb">
                    <fa-icon [icon]="faTrash"></fa-icon>
                  </a>

                </td>
              </tr>
              }
              @empty{
              <tr>
                <td colspan="12">
                  <p class="text-center">No hay contenidos existentes.</p>
                </td>
              </tr>
              }
            </tbody>
          </table>

          <paginator class="d-flex justify-content-end" [paginator]="paginator()"
            (childEvent)="cambiarPagina($event)" />

        </div>
      </div>
    </div>

  </div>
</div>
